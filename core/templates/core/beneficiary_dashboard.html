{% extends 'core/base.html' %}

{% block title %}ุนูุฏุฉ ุขููุฉ - ุฃุจุดุฑ{% endblock %}

{% block content %}
<!-- Absher-style Service Header -->
<div class="card" style="background: linear-gradient(135deg, #1a5f4a 0%, #2d8b6d 100%); color: white; margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
            <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">ุฎุฏูุงุช ุฃุจุดุฑ ุฃูุฑุงุฏ</div>
            <h1 style="font-size: 1.75rem; margin-bottom: 0.5rem;">๐ ุนูุฏุฉ ุขููุฉ</h1>
            <p style="opacity: 0.9; margin: 0;">ุจุฑูุงูุฌ ุฅุนุงุฏุฉ ุงูุงูุฏูุงุฌ ุงููุฌุชูุนู</p>
        </div>
        <div style="text-align: left;">
            <div style="font-size: 0.85rem; opacity: 0.8;">ุฑูู ุงููููุฉ</div>
            <div style="font-size: 1.25rem; font-family: monospace;">{{ user.national_id }}</div>
        </div>
    </div>
</div>

<!-- Welcome Message -->
<div class="card" style="border-right: 4px solid var(--primary); background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
    <h2 style="color: var(--primary-dark); margin-bottom: 0.75rem;">
        ูุฑุญุจุงู {{ user.full_name }} ๐
    </h2>
    <p style="margin: 0; color: var(--text-dark);">
        ุฃูุช ูุณุฌู ูู ุจุฑูุงูุฌ <strong>ุนูุฏุฉ ุขููุฉ</strong> ููุฏุนู ูุงููุชุงุจุนุฉ ููุฏุฉ 12 ุดูุฑ. 
        ูุฐู ุงูุฎุฏูุฉ ุชุฑุจุทู ุจุงูุฃุฎุตุงุฆููู ุงูุงุฌุชูุงุนููู ูุงูุฌูุงุช ุงูุฏุงุนูุฉ ููุณุงุนุฏุชู ูู ุฅุนุงุฏุฉ ุงูุงูุฏูุงุฌ.
    </p>
</div>

<!-- Progress Overview -->
<div class="grid grid-3" style="margin-bottom: 1.5rem;">
    <div class="card stat-card" style="text-align: center;">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">๐</div>
        <div class="stat-number" style="font-size: 2rem;">{{ profile.current_month }}/12</div>
        <div class="stat-label">ุงูุดูุฑ ุงูุญุงูู ูู ุงูุจุฑูุงูุฌ</div>
        <div class="progress-container" style="margin-top: 1rem;">
            <div class="progress-bar" style="width: {{ profile.progress_percentage }}%;"></div>
        </div>
    </div>
    
    <div class="card stat-card" style="text-align: center;">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">๐</div>
        <div style="font-size: 1.25rem; font-weight: 700;">{{ profile.get_city_display }}</div>
        <div class="stat-label">ููุทูุฉ ุงูุฎุฏูุฉ</div>
    </div>
    
    <div class="card stat-card" style="text-align: center;">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">๐</div>
        <div style="font-size: 1rem; font-weight: 700;">{{ profile.end_of_followup_date|date:"Y/m/d" }}</div>
        <div class="stat-label">ุชุงุฑูุฎ ุงูุชูุงุก ุงูุจุฑูุงูุฌ</div>
    </div>
</div>

<!-- Assigned Case Worker -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">๐จโ๐ผ ุงูุฃุฎุตุงุฆู ุงููุณุคูู ุนู ูุชุงุจุนุชู</h2>
    </div>
    
    {% if profile.assigned_case_worker %}
    <div style="display: flex; align-items: center; gap: 1.5rem; padding: 1rem; background: var(--bg-light); border-radius: 12px;">
        <div style="width: 70px; height: 70px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.75rem;">
            ๐ค
        </div>
        <div style="flex: 1;">
            <h3 style="margin: 0 0 0.25rem 0; color: var(--primary-dark);">{{ profile.assigned_case_worker.full_name }}</h3>
            <div style="color: var(--text-muted); margin-bottom: 0.5rem;">ุฃุฎุตุงุฆู ุงุฌุชูุงุนู</div>
            {% if profile.assigned_case_worker.phone %}
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="tel:{{ profile.assigned_case_worker.phone }}" class="btn btn-primary btn-sm">
                    ๐ ุงุชุตุงู: {{ profile.assigned_case_worker.phone }}
                </a>
                <a href="https://wa.me/966{{ profile.assigned_case_worker.phone|slice:'1:' }}" target="_blank" class="btn btn-secondary btn-sm" style="background: #25D366; color: white; border: none;">
                    ๐ฌ ูุงุชุณุงุจ
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">โณ</div>
        <p>ุณูุชู ุชุนููู ุฃุฎุตุงุฆู ููุชุงุจุนุชู ูุฑูุจุงู</p>
    </div>
    {% endif %}
</div>

<!-- My Progress Cards -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">๐ ููู ุงูุชูุฏู ุงูุฎุงุต ุจู</h2>
    </div>
    
    <div class="grid grid-2" style="gap: 1rem;">
        <!-- Training Courses -->
        <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 1.25rem; border-radius: 12px; border-right: 4px solid #3b82f6;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                <span style="font-size: 1.75rem;">๐</span>
                <div>
                    <div style="font-size: 0.85rem; color: #1e40af;">ุงูุฏูุฑุงุช ุงูุชุฏุฑูุจูุฉ</div>
                    <div style="font-size: 1.75rem; font-weight: 800; color: #1e3a8a;">2</div>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #3b82f6;">ูุณุฌู ูู ุฏูุฑุชูู ุญุงููุงู</div>
        </div>
        
        <!-- Job Applications -->
        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 1.25rem; border-radius: 12px; border-right: 4px solid #22c55e;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                <span style="font-size: 1.75rem;">๐ผ</span>
                <div>
                    <div style="font-size: 0.85rem; color: #166534;">ุทูุจุงุช ุงูุชูุธูู</div>
                    <div style="font-size: 1.75rem; font-weight: 800; color: #14532d;">5</div>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #22c55e;">ุชู ุงูุชูุฏูู ุนูู 5 ูุธุงุฆู</div>
        </div>
        
        <!-- Case Worker Visits -->
        <div style="background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); padding: 1.25rem; border-radius: 12px; border-right: 4px solid #eab308;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                <span style="font-size: 1.75rem;">๐</span>
                <div>
                    <div style="font-size: 0.85rem; color: #854d0e;">ุงูุฒูุงุฑุงุช ุงููุงุฏูุฉ</div>
                    <div style="font-size: 1.75rem; font-weight: 800; color: #713f12;">1</div>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #ca8a04;">ุฒูุงุฑุฉ ุงูุฃุฎุตุงุฆู ุฎูุงู ุฃุณุจูุน</div>
        </div>
        
        <!-- Completed Checkins -->
        <div style="background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 100%); padding: 1.25rem; border-radius: 12px; border-right: 4px solid #a855f7;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                <span style="font-size: 1.75rem;">โ</span>
                <div>
                    <div style="font-size: 0.85rem; color: #7e22ce;">ุงููุชุงุจุนุงุช ุงูููุชููุฉ</div>
                    <div style="font-size: 1.75rem; font-weight: 800; color: #581c87;">{{ profile.checkins.count }}/12</div>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #a855f7;">ุฃูููุช {{ profile.checkins.count }} ูุชุงุจุนุฉ ุดูุฑูุฉ</div>
        </div>
    </div>
</div>

<!-- Housing & Work Status -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">๐ ุจูุงูุงุช ุงูุณูู ูุงูุนูู</h2>
    </div>
    
    <div class="grid grid-2" style="gap: 1.5rem;">
        <!-- Housing Info -->
        <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 12px;">
            <h3 style="color: var(--primary-dark); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <span>๐</span> ุญุงูุฉ ุงูุณูู
            </h3>
            {% with latest=profile.checkins.first %}
            {% if latest %}
            <div style="margin-bottom: 0.75rem;">
                <div style="font-size: 0.85rem; color: var(--text-muted);">ููุน ุงูุณูู:</div>
                <div style="font-weight: 600; font-size: 1.1rem;">
                    {% if latest.housing_status == 'with_family' %}
                    ๐จโ๐ฉโ๐ง ูุน ุงูุนุงุฆูุฉ
                    {% elif latest.housing_status == 'stable' %}
                    ๐ก ุณูู ูุณุชูู (ุฅูุฌุงุฑ)
                    {% elif latest.housing_status == 'temporary' %}
                    ๐จ ุณูู ูุคูุช / ุบุฑู ุนุฒุงุจ
                    {% else %}
                    โ๏ธ ูุญุชุงุฌ ุฏุนู ุณููู
                    {% endif %}
                </div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">ุฃูุงู ุงูุณูู:</div>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                    {% if latest.housing_status == 'homeless' %}
                    <span style="color: var(--danger);">๐ด ุบูุฑ ูุณุชูุฑ</span>
                    {% elif latest.housing_status == 'temporary' %}
                    <span style="color: var(--warning);">๐ก ูุคูุช</span>
                    {% else %}
                    <span style="color: var(--success);">๐ข ูุณุชูุฑ</span>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <p style="color: var(--text-muted);">ูู ูุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุณูู ุจุนุฏ</p>
            {% endif %}
            {% endwith %}
        </div>
        
        <!-- Work Info -->
        <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 12px;">
            <h3 style="color: var(--primary-dark); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <span>๐ผ</span> ุญุงูุฉ ุงูุนูู
            </h3>
            {% with latest=profile.checkins.first %}
            {% if latest %}
            <div style="margin-bottom: 0.75rem;">
                <div style="font-size: 0.85rem; color: var(--text-muted);">ุงูุญุงูุฉ ุงููุธูููุฉ:</div>
                <div style="font-weight: 600; font-size: 1.1rem;">
                    {% if latest.job_status == 'employed' %}
                    โ ููุธู
                    {% elif latest.job_status == 'self_employed' %}
                    ๐ช ุนูู ุญุฑ
                    {% elif latest.job_status == 'training' %}
                    ๐ ูู ุชุฏุฑูุจ
                    {% elif latest.job_status == 'searching' %}
                    ๐ ูุจุญุซ ุนู ุนูู
                    {% else %}
                    โณ ุนุงุทู
                    {% endif %}
                </div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">ููุงู ุงูุนูู:</div>
                <div style="font-weight: 600;">
                    {% if latest.job_status == 'employed' or latest.job_status == 'self_employed' %}
                    ๐ {{ profile.get_city_display }}
                    {% else %}
                    --
                    {% endif %}
                </div>
            </div>
            {% else %}
            <p style="color: var(--text-muted);">ูู ูุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุนูู ุจุนุฏ</p>
            {% endif %}
            {% endwith %}
        </div>
    </div>
    
    <div style="margin-top: 1rem; text-align: center;">
        <a href="{% url 'checkin_form' %}" class="btn btn-primary btn-sm">
            ๐ ุชุญุฏูุซ ุจูุงูุงุชู
        </a>
    </div>
</div>

<!-- My Support Requests -->
{% if open_tickets %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">๐ ุทูุจุงุช ุงูุฏุนู ุงูุฎุงุตุฉ ุจู</h2>
    </div>
    
    {% for ticket in open_tickets %}
    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 10px; margin-bottom: 0.75rem;">
        <div style="font-size: 1.5rem;">
            {% if ticket.ticket_type == 'job' %}๐ผ{% elif ticket.ticket_type == 'psychological' %}๐ง{% elif ticket.ticket_type == 'housing' %}๐{% elif ticket.ticket_type == 'social' %}๐ค{% else %}๐ฐ{% endif %}
        </div>
        <div style="flex: 1;">
            <div style="font-weight: 600;">
                {% if ticket.ticket_type == 'job' %}ูุณุงุนุฏุฉ ูู ุงูุชูุธูู
                {% elif ticket.ticket_type == 'psychological' %}ุฏุนู ููุณู
                {% elif ticket.ticket_type == 'housing' %}ูุณุงุนุฏุฉ ุณูููุฉ
                {% elif ticket.ticket_type == 'social' %}ุฏุนู ุงุฌุชูุงุนู
                {% else %}ูุณุงุนุฏุฉ ูุงููุฉ{% endif %}
            </div>
            <div style="font-size: 0.85rem; color: var(--text-muted);">
                {% if ticket.status == 'open' %}โณ ููุฏ ุงููุฑุงุฌุนุฉ
                {% elif ticket.status == 'in_progress' %}๐ ุฌุงุฑู ุงูุนูู ุนููู
                {% elif ticket.status == 'resolved' %}โ ุชู
                {% else %}๐ ูุบูู{% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Quick Actions for Beneficiary -->
<div class="card" style="background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-light) 100%);">
    <div class="card-header">
        <h2 class="card-title">โก ุฎุฏูุงุช ุณุฑูุนุฉ</h2>
    </div>
    
    <div class="grid grid-2">
        <a href="{% url 'checkin_form' %}" class="card" style="text-decoration: none; color: inherit; text-align: center; margin-bottom: 0; transition: transform 0.2s;">
            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">๐</div>
            <h3 style="color: var(--primary-dark); margin-bottom: 0.5rem;">ุชุญุฏูุซ ุญุงูุชู</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">ุฃุฎุจุฑูุง ุนู ูุถุนู ุงูุญุงูู (ุณููุ ุนููุ ุญุงูุฉ ููุณูุฉ)</p>
        </a>
        
        <a href="{% url 'job_list' %}" class="card" style="text-decoration: none; color: inherit; text-align: center; margin-bottom: 0; transition: transform 0.2s;">
            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">๐ผ</div>
            <h3 style="color: var(--primary-dark); margin-bottom: 0.5rem;">ูุฑุต ุงูุนูู</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">ุชุตูุญ ุงููุธุงุฆู ุงููุชุงุญุฉ ูู {{ profile.get_city_display }}</p>
        </a>
        
        <a href="{% url 'beneficiary_messages' %}" class="card" style="text-decoration: none; color: inherit; text-align: center; margin-bottom: 0; transition: transform 0.2s;">
            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">๐ฌ</div>
            <h3 style="color: var(--primary-dark); margin-bottom: 0.5rem;">ุชูุงุตู ูุน ุงูุฃุฎุตุงุฆู</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">ุฃุฑุณู ุฑุณุงูุฉ ุฃู ุงุณุชูุณุงุฑ</p>
        </a>
        
        <a href="{% url 'support_services' %}" class="card" style="text-decoration: none; color: inherit; text-align: center; margin-bottom: 0; transition: transform 0.2s;">
            <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">๐ค</div>
            <h3 style="color: var(--primary-dark); margin-bottom: 0.5rem;">ุงูุฌูุงุช ุงูุฏุงุนูุฉ</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">ุชุฑุงุญูุ ุงูุถูุงูุ ุฌูุนูุงุช ุงูุฏุนู</p>
        </a>
    </div>
</div>

<!-- Notifications -->
{% if notifications %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">๐ ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ</h2>
    </div>
    {% for notif in notifications %}
    <div class="notification-item unread">
        <span>{{ notif.message }}</span>
        <small style="color: var(--text-muted); margin-right: auto;">{{ notif.created_at|timesince }}</small>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Emergency Contacts -->
<div class="card" style="background: #fef2f2; border: 1px solid #fecaca;">
    <div class="card-header" style="border-bottom-color: #fecaca;">
        <h2 class="card-title" style="color: #dc2626;">๐ ุฃุฑูุงู ุงูุทูุงุฑุฆ</h2>
    </div>
    <div class="grid grid-3">
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">๐ง</div>
            <div style="font-weight: 600;">ุฎุท ุชุฑุงุญู</div>
            <div style="color: var(--primary); font-size: 1.25rem;">920033360</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">ุฏุนู ููุณู 24/7</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">๐ฐ</div>
            <div style="font-weight: 600;">ุงูุถูุงู ุงูุงุฌุชูุงุนู</div>
            <div style="color: var(--primary); font-size: 1.25rem;">800-124-1212</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">ูุณุงุนุฏุงุช ูุงููุฉ</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">๐</div>
            <div style="font-weight: 600;">ุฌูุนูุฉ ุงูุฅุณูุงู</div>
            <div style="color: var(--primary); font-size: 1.25rem;">920020505</div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">ุฏุนู ุณููู</div>
        </div>
    </div>
</div>
{% endblock %}
